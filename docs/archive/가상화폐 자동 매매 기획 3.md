# 가상화폐 자동 매매 기획

---

# 💹 가상화폐 머신러닝 + LLM 하이브리드 자동매매 기획서 (with Groq API)

---

## 1️⃣ 프로젝트 개요

### 프로젝트명

**AutoTrader-LXA v3 (Hybrid ML + LLM Trader System)**

> 머신러닝 기반 실시간 시세 예측과
> 
> 
> LLM(로컬 Ollama + 클라우드 Groq API)을 결합한
> 
> **완전 자동화형 가상화폐 매매 시스템**
> 

### 핵심 개념

- **머신러닝(ML)** : BTC·ETH·XRP·SOL의 Tick-level 시세 데이터를 기반으로 실시간 매수/매도 판단
- **LLM 이중 검증 구조** :
    1. 1차 검증 — **Groq API (클라우드 LLM)**
    2. 2차 검증 — **Ollama (로컬 LLM)**
    → 두 엔진이 머신러닝 판단과 모두 일치할 경우에만 거래 실행.
- **긴급 매도 시스템** : 급락·조작 패턴을 머신러닝이 탐지하면 LLM 단계를 우회하고 즉시 매도.

---

## 2️⃣ 시스템 핵심 철학

| 항목 | 내용 |
| --- | --- |
| 투자 성격 | 단기/초단기 자동매매 (분~시간 단위) |
| ML 기반 판단 | 시장 패턴 기반, 실시간 매매 확률 출력 |
| LLM 기반 검증 | 뉴스·시장심리·트렌드 검증 (Groq + Ollama 병행) |
| 긴급매도 | ML의 이상탐지 시 곧바로 청산 |
| 동작 모드 | 완전 자동 (User 개입 無) |
| 주요 자산 | BTC, ETH, XRP, SOL |
| 목표 성능 | 월 +20% 수익률, 손실 -3% 이하 제어 |

---

## 3️⃣ 전체 아키텍처 (ML + 듀얼 LLM 구조)

```
[실시간 데이터 파이프라인] ──────────────
 ↳ Upbit WebSocket Ticker / Orderbook
 ↳ 뉴스 / 트렌드 / 온체인 / 매크로데이터

          ↓

[AI 판단 엔진 Layer]

 (1) 머신러닝 예측 모듈
     ↳ 3년치 Tick 데이터 학습 (BTC/ETH/XRP/SOL)
     ↳ 실시간 매수·매도 확률 산출 (매 분 단위)
     ↳ 긴급 매도 감시 (AutoEncoder+Volatility+Volume Spike)

          ↓

 (2) LLM 검증 모듈
     ↳ Groq API (클라우드 LLM – 무료, 초저지연)
     ↳ Ollama (로컬 LLM – DeepSeek/Qwen)
     ↳ ML 예측 내용을 두 LLM이 각자 검증
     ↳ Groq + Ollama + ML 세 엔진 일치 시 거래 승인

          ↓

(3) 거래 실행 모듈
     ↳ Upbit REST API 자동 주문
     ↳ Slippage 제어 / 손익 자동 관리 / 긴급 매도 Fast Path

          ↓

[모니터링·리포팅 대시보드]
 ↳ FastAPI 백엔드 + React UI
 ↳ 거래내역, 수익률, 판단로그, 알림
 ↳ Slack / Telegram 통보

```

---

## 4️⃣ 머신러닝 자동매매 설계

### (1) 학습 데이터 구성

| 항목 | 내용 |
| --- | --- |
| 기간 | 3년 (2022~2025) |
| 종목 | BTC, ETH, XRP, SOL |
| 주기 | Tick-level (~초 단위) |
| 소스 | Upbit 거래내역·웹소켓 아카이브 + CryptoCompare |
| 피처 | 가격, 거래량, 체결 강도, 오더북 스프레드, RSI, MACD, 뉴스 감성지수, Google Trend Score |

데이터는 시계열 정규화하여 Parquet 형태로 저장하고, PostgreSQL에 인덱싱하여 조회.

---

### (2) 라벨링 및 전처리

```python
# 예측 목표: 10분 후 수익률이 +0.2% 이상이면 매수 라벨
data['future_return'] = data['close'].shift(-120)/data['close']-1
data['label'] = (data['future_return'] > 0.002).astype(int)

```

- time-step 윈도우: 60초 × 60분 × 최근 24시간 sliding
- normalization: log-scale 변환, rolling mean/std 정규화

---

### (3) 모델 구조

| 모델 | 설명 |
| --- | --- |
| **LSTM + CNN Hybrid** | 단기 가격패턴과 변동성 결합 |
| **LightGBM Stack** | 개별 코인 예측 확률 보정 |
| **Autoencoder** | 급변 패턴 이상 탐지 (긴급매도 트리거) |

**출력:**

$$ P(\text{buy}), P(\text{sell}) = f_{ML}(X_{t:t-60}) $$

예측 결과 중 가장 상승 확률이 높고 안정성이 높은 코인을 매수 대상으로 선정.

---

## 5️⃣ LLM 검증 엔진 설계

### (1) Groq API 기반 클라우드 LLM

- **특징**
    - 무료 사용 가능, 카드 정보 불필요
    - 고속 추론(NPU 기반), 초저지연 응답
    - 다양한 모델(Llama3.1-8B/70B, Gemma2 등) 사용 가능
    - REST API 구조로 FastAPI 백엔드에 직접 연동 가능
    ()
- **역할**
    - 머신러닝의 판단을 신속하게 검증
    - 뉴스 감성, 심리, 외부 요인을 텍스트 기반 판단
    - 1차 필터(빠른 yes/no 판단)로 사용

```python
import requests

def groq_verify(decision_summary):
    api_key = ""
    payload = {"model": "llama3-8b", "prompt": decision_summary}
    headers = {"Authorization": f"Bearer {api_key}"}
    res = requests.post("<https://api.groq.com/v1/chat/completions>", json=payload, headers=headers)
    return res.json()["choices"][0]["message"]["content"]

```

---

### (2) Ollama 기반 로컬 LLM 검증

- **모델:** DeepSeek-R1 / Qwen2 14B
- **특징:** 오프라인 동작, 보안 강화, 네트워크 없이 판단 가능
- **역할:** Groq 검증을 통과한 거래에 대해 2차 전략적 타당성 심사

---

### (3) 판단 흐름 요약

| 단계 | 엔진 | 역할 |
| --- | --- | --- |
| ① | ML Core | 매매 신호 생성 |
| ② | Groq API | 1차 검증 (AI 심리·뉴스 관점) |
| ③ | Ollama (로컬) | 2차 검증 (기술적·전략적 관점) |
| ④ | LLM 투자비율 결정 | 원금 대비 적정 투자 비율 산정 (5~100%) |
| ⑤ | 결과 일치 | 매매 실행 (LLM이 결정한 비율로) |
| ⑥ | 불일치 | Hold 대기 |

### (4) LLM 기반 투자 비율 결정

머신러닝 모델은 시장의 방향성을 예측하지만, **투자 원금 대비 적정 투자 비율**은 계산하기 어렵습니다.
따라서 다음 정보를 LLM에게 제공하여 투자 비율을 결정하도록 합니다:

**LLM에게 제공하는 정보:**
- 현재 보유 원금 및 가용 자금
- 현재 포지션 현황 (보유 코인, 평가손익)
- ML 신호 강도 (buy_probability, confidence_score)
- 시장 변동성 지표 (ATR, 볼린저밴드 폭)
- 최근 거래 성공률 및 손익 히스토리
- 리스크 레벨 (긴급 상황 점수)

**LLM 출력:**
```json
{
  "investment_ratio": 0.15,  // 원금의 15% 투자
  "reasoning": "높은 신뢰도(0.85)와 낮은 변동성으로 중간 수준 투자 권장",
  "max_loss_acceptable": 0.03,  // 최대 허용 손실 3%
  "take_profit_target": 0.05  // 목표 수익률 5%
}
```

**투자 비율 결정 원칙:**
- ML 신호 강도가 높고 변동성이 낮으면 → 높은 비율 (50~100%)
- ML 신호 강도가 중간이고 변동성이 중간이면 → 중간 비율 (20~50%)
- ML 신호 강도가 낮거나 변동성이 높으면 → 낮은 비율 (5~20%)
- 연속 손실 상태이면 → 비율 감소 (5~10%)
- 연속 수익 상태이면 → 비율 점진적 증가 (최대 100%)

---

## 6️⃣ 패턴 기반 긴급 자동 매도 시스템

| 조건 | 트리거 기준 | 설명 |
| --- | --- | --- |
| 급락 속도 | 5분 내 -1% ↓ | 이상치 감지 즉시 매도 |
| 거래량 폭증 | +400~600% 수준 | 조작 가능성 매도 |
| Autoencoder Score | 0.95↑ | 비정상 시세 |
| 악성 뉴스 감성 | -0.6↓ | LLM 감성분석 기반 즉시 매도 |
| 네트워크 오류 | 3회 연속 실패 | API 재시도 후 강제 청산 |

비정상 이벤트 발생 시 LLM 판단 생략 후 **즉시 API 매도** 로직 수행.

---

## 7️⃣ 자동 매매 의사결정 트리

| 구분 | ML 예측 | Groq API | Ollama | 결과 |
| --- | --- | --- | --- | --- |
| Case 1 | 매수 | 매수 | 매수 | **매수 실행** |
| Case 2 | 매도 | 매도 | 매도 | **매도 실행** |
| Case 3 | 매수 | 유지 | 매수 | 대기 |
| Case 4 | 매도 | 매수 | 유지 | 대기 |
| Case 5 | 긴급 탐지 | - | - | **즉시 매도** |

---

## 8️⃣ ML+LLM 협동 루프 및 피드백

- 매 거래 시
    - ML의 입력·예측값
    - Groq/Ollama의 판단 로그
    → PostgreSQL에 저장
- 일별 재학습 시, LLM 피드백 로그를 ML 학습 데이터에 반영
(LLM 판단이 맞았던 구간 가중치↑ / 오류구간 가중치↓)

---

## 9️⃣ 기술 스택 정리

| 영역 | 기술 | 역할 |
| --- | --- | --- |
| 실시간 데이터 | `pyupbit`, `aiohttp` | 시세/거래 데이터 수집 |
| 머신러닝 | `PyTorch`, `LightGBM`, `Optuna` | 예측 학습 및 모델 튜닝 |
| LLM (로컬) | `Ollama (DeepSeek/Qwen)` | 전략 검증 |
| LLM (클라우드) | `Groq API` | 초저지연 뉴스/심리 검증 |
| DB | `PostgreSQL`, `Redis` | 거래기록·모델캐시 |
| 백엔드 | `FastAPI`, `Celery` | 비동기 자동매매 처리 |
| 대시보드 | `React.js + Chart.js` | 실시간 수익률/거래 UI |
| 경보 시스템 | `Slack / Telegram API` | 거래 알림·리포트 |

---

## 🔟 기대 효과

| 항목 | 내용 |
| --- | --- |
| 🚀 최신성 향상 | Groq API로 최신 뉴스 판단 + Ollama 오프라인 추론 결합 |
| 💡 비용 최소화 | Groq API 무료 / Ollama 로컬 무료 |
| 🔒 보안 유지 | 데이터 로컬 유지, 외부 전송 최소화 |
| ⚙️ 완전 자동화 | ML→LLM→Trade 전 과정 자동화 |
| 📈 수익 추구 | 4대 자산 동시 감시, 최적 자산 집중 매수로 효율 극대화 |

---

## 🧩 결론

AutoTrader-LXA v3는

**머신러닝(정량 패턴 감지)** + **듀얼 LLM(정성 검증, Groq + Ollama)** + **긴급 자동 대응**을 통합한

실시간 완전 자동매매 시스템입니다.

Groq API의 무료 클라우드 처리로 **신속한 1차 검증**을 수행하고,

Ollama 로컬 모델이 **보안 기반의 2차 검증 및 심화 판단**을 맡습니다.

이 구조를 통해, 속도·정확도·안정성 세 요소를 모두 확보합니다.

---