# 트레이딩 시스템 v5.0 업그레이드 가이드

## 📈 주요 변경사항

### 문제점 분석
기존 시스템에서 급등 코인 수익화가 어려웠던 이유:

1. **뒤늦은 급등 감지**: 이미 1.5% 상승한 후에야 감지 (추격매수)
2. **고정 익절 비율**: 2~10% 고정으로 급등 시 조기 매도
3. **보수적 신호 필터**: 연속 BUY 80% 이상만 허용
4. **낮은 투자 비율**: 급등 감지해도 최대 20%만 투자
5. **피크 감지 부재**: 최고점에서 매도하는 로직 없음

### v5.0 해결책

## 1. PumpPredictor (신규)

```python
# 급등 조짐 사전 감지 + 피크 매도
from app.trading.pump_predictor import PumpPredictor

predictor = PumpPredictor()
signal = predictor.analyze(market, df, price, volume, has_position, entry_price)

# signal.signal_type: 'PRE_PUMP', 'PUMPING', 'PEAK', 'NONE'
# signal.action: 'BUY', 'SELL', 'HOLD'
```

**핵심 기능:**
- **PRE_PUMP 감지**: 거래량 2배 급증 + 0.3~1.0% 초기 상승 감지
- **PEAK 감지**: 트레일링 스탑 (고점 대비 1.5% 하락) + RSI 과열 감지
- **동적 익절**: 수익 극대화를 위한 트레일링 스탑

## 2. BreakoutStrategy 개선

**변경 전:**
- 거래량 2배 + 가격 돌파 + RSI 50~85 필요
- Dead Cross나 MA20 이탈에만 매도

**변경 후:**
- 거래량 1.5배만으로도 매수 고려 (더 빠른 진입)
- RSI 45~88으로 완화 (급등장 대응)
- RSI 피크 감지: 80 이상 → 78 미만 하락 시 매도
- 급락 감지: 직전 캔들 대비 1.5% 이상 하락 시 즉시 매도

## 3. SignalFilter 완화

**변경 전:**
- 연속 신호 허용: 80% 이상 신뢰도 필요
- 이전 거래 80% 이상이면 추가 연속 신호 차단

**변경 후:**
- BUY 연속 신호: **70%** 이상이면 허용 (급등장 대응)
- SELL 연속 신호: 75% 이상이면 허용
- 차단 조건: 이전 거래 **90%** 이상일 때만 (더 관대)

## 4. 투자 비율 상향

| 신뢰도 | 변경 전 | 변경 후 |
|--------|---------|---------|
| ≥90%   | -       | **40%** (신규) |
| ≥85%   | 20%     | **30%** |
| ≥75%   | 15%     | **25%** |
| ≥65%   | 10%     | **15%** |
| <65%   | 5%      | **10%** |

## 5. 동적 SL/TP 개선

| 신뢰도 | 손절(SL) | 익절(TP) | 손익비 |
|--------|----------|----------|--------|
| ≥90%   | 1.0%     | **15%**  | 1:15   |
| ≥80%   | 1.2%     | **10%**  | 1:8    |
| ≥70%   | 1.5%     | **8%**   | 1:5    |
| <70%   | 2%       | **5%**   | 1:2.5  |

## 6. 설정 변경

```python
# config.py 변경사항
pump_threshold_percent = 0.8   # 1.5% → 0.8% (더 민감)
pump_check_interval = 1.0      # 2초 → 1초 (더 빠름)
pump_lookback_seconds = 30     # 60초 → 30초 (더 민감)
pump_investment_ratio = 0.30   # 20% → 30% (더 공격적)

# 신규 설정
trailing_stop_enabled = True
trailing_stop_pct = 0.015      # 1.5% 트레일링 스탑
peak_rsi_threshold = 78.0      # RSI 78 이상에서 하락 시 피크
```

## 🚀 기대 효과

1. **급등 초기 진입**: 0.3~1.0% 상승 단계에서 매수 (기존: 1.5% 후)
2. **수익 극대화**: 트레일링 스탑으로 고점 근처까지 홀딩
3. **피크 매도**: RSI 과열 + 가격 하락 감지 시 자동 청산
4. **더 많은 기회**: 신호 필터 완화로 급등장에서 연속 매수 가능
5. **높은 수익률**: 투자 비율 상향 + 넓은 TP로 수익 극대화

## ⚠️ 주의사항

- 더 공격적인 전략은 리스크도 증가
- 손절선(SL)은 여전히 타이트하게 유지 (1~2%)
- 급등 후 급락 시 손실 가능성 있음
- 백테스트 및 소액 테스트 권장

## 📊 모니터링

로그에서 다음 키워드 확인:
- `🚀 PRE-PUMP 감지`: 급등 조짐 사전 감지
- `🔔 Peak Detected`: 피크 감지 및 매도
- `🔔 피크 감지 (RSI ...)`: RSI 기반 피크 매도
- `🟡 연속 BUY 신호 허용`: 급등장 연속 매수 허용
